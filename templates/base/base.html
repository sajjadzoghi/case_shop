{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <title>کالاشاپ - {% block title %}{% endblock %}</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="{% static 'base/base.css' %}">
    {% block style %}{% endblock %}

</head>
<body>
<nav class="navbar navbar-expand fixed-top">
    <div class="container flex-row-reverse">
        <button class="button-logo"><img src="{% static 'base/img/kalashop-logo.png' %}" alt="kalashop-logo"></button>
        <div class="navbar-collapse flex-column">
            <div class="navbar-nav ml-auto flex-row-reverse">
                <div class="input-group" style="width: 33.5rem">
                    <div class="input-group-prepend cancel-btn">
                        <a href="#"><i class="fa fa-fw fa-close"></i></a>
                    </div>
                    <input class="input-search" type="text" placeholder="جستجو">
                    <div class="input-group-append search-btn">
                        <a href="#"><i class="fa fa-fw fa-search"></i></a>
                    </div>
                </div>
                {% if user.is_authenticated %}
                    <div style="width: 2rem;margin-right: 19rem;">
                        <div class="dropdown">
                            <a href="#"><i class="fa fa-fw fa-user" style="font-size:35px"></i></a>
                            <div class="dropdown-content card dropdown-user">
                                <div class="card-header">
                                    <h4>{{ user.first_name }} {{ user.last_name }}</h4>
                                </div>
                                <div class="card-body" style="text-align: right">
                                    <a href="#" style="font-size: 14px">مشاهده حساب کاربری<i
                                            class="fa fa-fw fa-user-circle-o"></i></a><br>
                                    <a href="#" style="font-size: 14px">سفارش‌های من<i
                                            class="fa fa-fw fa-shopping-bag"></i></a><br>
                                    <a href="{% url 'accounts:logout' %}" style="font-size: 14px">خروج از حساب کاربری<i
                                            class="fa fa-fw fa-sign-out"></i></a>
                                </div>
                            </div>
                        </div>
                    </div>
                {% else %}
                    <div style="width: 10rem;margin-right: 15rem">
                        <button class="auth-btn" data-toggle="modal"
                                data-target="#register-modal">ثبت‌نام
                        </button>
                        <button class="auth-btn"><a href="{% url 'accounts:login' %}">ورود<i class="fa fa-fw fa-user"
                                                                                             style="font-size:18px"></i></a>
                        </button>
                    </div>
                {% endif %}
                <div style="height: 1.5rem;border: 0.001mm ridge silver;margin-right: 10px;margin-top: 5px"></div>

                <p id="cart-quantity"></p>
                <div>

                    <button id="cart-btn" data-toggle="modal" data-target="#cart-modal" href="#"><i
                            class="fa fa-fw fa-shopping-cart"
                            style="font-size:35px;padding-left: 10px;cursor: pointer"></i></button>

                </div>

            </div>
            <ul class="navbar-nav ml-auto">
                <li class="nav-item">
                    <a class="nav-link" href="#">تماس با کالاشاپ<i class="fa fa-fw fa-phone"></i></a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">درباره کالاشاپ<i class="fa fa-fw fa-info-circle"></i></a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">تخفیف‌ها و پیشنهادها<i class="fa fa-fw fa-percent"></i></a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">سوپر مارکت<i class="fa fa-fw fa-shopping-basket"></i></a>
                </li>
                <li class="nav-item">
                    <div class="dropdown">
                        <a class="dropbtn nav-link" href="#">دسته‌بندی کالاها<i class="fa fa-fw fa-bars"></i></a>
                        <div class="dropdown-content dropdown-cat">
                            <a href="#">کالای دیجیتال<i class="fa fa-fw fa-laptop"></i></a>
                            <a href="#">کالاهای سوپرمارکتی<i class="fa fa-fw fa-shopping-basket"></i></a>
                            <a href="#">لوازم جانبی<i class="fa fa-fw fa-headphones"></i></a>
                            <a href="#">اسباب‌‌ بازی، کودک و نوزاد<i class="fa fa-fw fa-child"></i></a>
                            <a href="#">زیبایی و سلامت<i class="fa fa-fw fa-heart"></i></a>
                            <a href="#">خانه و آشپزخانه<i class="fa fa-fw fa-table"></i></a>
                            <a href="#">کتاب، لوازم‌التحریر و هنر<i class="fa fa-fw fa-pencil"></i></a>
                            <a href="#">ورزش و سفر<i class="fa fa-fw fa-soccer-ball-o"></i></a>
                        </div>
                    </div>
                </li>
            </ul>
        </div>
    </div>
</nav>

<div class="container-fluid">
    {% block modal %}{% endblock %}
    <div class="modal fade" id="register-modal">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-body">
                    <form method="POST" action="{% url 'send_info' %}" id="register-form" enctype="multipart/form-data">

                        <div class="form-group" id="reg-mobile-group">
                            <label for="reg-mobile">:شماره موبایل</label>
                            <input type="text" class="form-control" name="reg-mobile" id="reg-mobile">
                        </div>
                        <div class="form-group" id="first_name-group">
                            <label for="first_name">:نام</label>
                            <input type="text" class="form-control" name="first_name" id="first_name">
                        </div>
                        <div class="form-group" id="last_name-group">
                            <label for="last_name">:نام‌خانوادگی</label>
                            <input type="text" class="form-control" name="last_name" id="last_name">
                        </div>
                        <div class="form-group" id="email-group">
                            <label for="email">:ایمیل</label>
                            <input type="text" class="form-control" name="email" id="email">
                        </div>
                        <div class="form-group" id="reg-password-group">
                            <label for="reg-password">:رمز عبور</label>
                            <input type="text" class="form-control" name="reg-password" id="reg-password">
                        </div>
                        <div class="btn-group" id="reg-btn-group">
                            <button type="button" class="btn btn-danger" data-dismiss="modal">انصراف</button>
                            <button type="submit" class="btn btn-submit mr-3" id="send-info-btn">
                                تکمیل ثبت نام
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="otp-modal">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-body">
                    <form method="POST" action="{% url 'verify_otp' %}" id="otp-form" enctype="multipart/form-data">

                        <div class="form-group" id="otp-group">
                            <label for="otp">:کد تایید ارسال‌شده به گوشی را وارد کنید</label>
                            <input type="number" class="form-control" name="otp" id="otp" maxlength="6" minlength="6">
                        </div>
                        <div class="btn-group" id="otp-btn-group">
                            <button type="button" class="btn btn-danger" data-dismiss="modal">انصراف</button>
                            <button type="submit" class="btn btn-submit mr-3" id="verify-otp-btn">
                                ارسال
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="cart-modal">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-body">
                    <div>
                        <h4 id="cart-total-price" class="text-dark"></h4>
                    </div>
                    <div class="btn-group mt-3" id="cart-btn-group">
                        <button class="btn btn-danger mr-3" data-dismiss="modal">بستن</button>
                        <button class="btn btn-submit mr-3" data-dismiss="modal"><a href="{% url 'order:order' %}"></a>
                            ثبت سفارش
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% block content %}{% endblock %}
</div>
<script src="{% static 'accounts/js/register.js' %}"></script>
<script>
    if (sessionStorage.cart_quantity) {
        $('#cart-quantity').html(sessionStorage.cart_quantity);
    } else {
        $('#cart-quantity').html(0);
    }

    if (sessionStorage.total_price) {
        if (sessionStorage.total_price !== '0') {
            $('#cart-total-price').html(`جمع کل: ${Number(sessionStorage.total_price)} تومان`);
        } else {
            $('#cart-total-price').hide();
            $('#cart-btn-group').hide();
            $('#cart-modal .modal-body').prepend(`<h4 id="is-empty">!سبد خرید شما خالی است</h4>`);
            $('#cart-modal .modal-body').append(`<button type="button" id="empty-button" class="btn btn-danger" data-dismiss="modal">بستن</button>`);
        }
    } else {
        $('#cart-total-price').hide();
        $('#cart-btn-group').hide();
        $('#cart-modal .modal-body').prepend(`<h4 id="is-empty">!سبد خرید شما خالی است</h4>`);
        $('#cart-modal .modal-body').append(`<button type="button" id="empty-button" class="btn btn-danger" data-dismiss="modal">بستن</button>`);
    }

    if (sessionStorage.items) {
        let items = JSON.parse(sessionStorage.items);
        for (let item of items) {
            $('#cart-modal .modal-body').prepend(`<div id="item${item.id}">
                    <div class="row" style="direction: rtl;margin-right: 1px">
                        <img alt="item" src="${item.image}">
                        <h5 class="text-dark" style="margin-top: 2rem;margin-right: 3px">${item.name}</h5>
                        <i onclick="remove_item('${item.id}')" class="fa fa-fw fa-trash"
                           style="font-size: 32px;margin-right: auto;margin-left: 5px;margin-top: 1.6rem;cursor: pointer"></i>
                    </div>
                    <div class="row" style="direction: rtl;margin-right: 1px">
                        <p class="text-dark">${item.quantity} عدد</p>
                        <div style="height: 1.2rem;border: 0.001mm ridge grey;margin-right: 2rem;margin-left: 2rem;"></div>
                        <p class="text-dark">رنگ ${item.color}</p>
                        <div style="height: 1.2rem;border: 0.001mm ridge grey;margin-right: 2rem;margin-left: 2rem;"></div>
                        <p class="text-dark">قیمت واحد: ${item.price} تومان</p>
                    </div>
                    <h5 class="text-dark" style="direction: rtl">قیمت نهایی: ${Number(item.price) * Number(item.quantity)} تومان</h5>
                    <p>_____________________________________________</p>
                </div>`);
        }
    }

    function remove_item(id) {
        sessionStorage.cart_quantity = Number(sessionStorage.cart_quantity) - 1;
        $('#cart-quantity').html(sessionStorage.cart_quantity);
        if (sessionStorage.cart_quantity === '0') {
            $('#cart-total-price').hide();
            $('#cart-btn-group').hide();
            $('#cart-modal .modal-body').prepend(`<h4 id="is-empty">!سبد خرید شما خالی است</h4>`);
            $('#cart-modal .modal-body').append(`<button type="button" id="empty-button" class="btn btn-danger" data-dismiss="modal">بستن</button>`);
        }

        let items = JSON.parse(sessionStorage.items);
        let new_items = [];
        let new_total = 0;
        for (let item of items) {
            if (item.id !== id) {
                new_items.push(item);
                new_total += (Number(item.price) * Number(item.quantity));
                }
            }
        items = new_items;
        sessionStorage.items = JSON.stringify(items);
        sessionStorage.total_price = new_total;
        $('#cart-total-price').html(`جمع کل: ${sessionStorage.total_price} تومان`);


        $(`#cart-modal #item${id}`).remove();
        $(`#add-product${id}`).prop('disabled', '').removeClass('active');
    }



</script>
{% block script %}
{% endblock %}
</body>
</html>


